---
import Layout from '~/layouts/Layout.astro';
import { getCategories, getPostsByCategory } from '../../../lib/api';

const categories = await getCategories();

// Get post counts for each category
const categoriesWithCounts = await Promise.all(
    categories.map(async (category) => {
        const posts = await getPostsByCategory(category.id);
        return {
            ...category,
            postCount: posts.length
        };
    })
);
---

<Layout title="Categories">
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-serif font-bold text-gray-900 mb-4">Categories</h1>
            <p class="text-lg text-gray-600">Browse all our content categories</p>
        </header>

        <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
            {categoriesWithCounts.map((category) => (
                <a 
                    href={`/categories/${category.slug}/`}
                    class="block p-6 bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow border border-gray-100"
                >
                    <div class="flex justify-between items-start mb-2">
                        <h2 class="text-xl font-bold text-gray-900">{category.name}</h2>
                        <span class="px-2 py-1 text-sm font-medium bg-gray-100 text-gray-700 rounded-full">
                            {category.postCount} posts
                        </span>
                    </div>
                    {category.description && (
                        <p class="text-gray-600 line-clamp-2">{category.description}</p>
                    )}
                </a>
            ))}
        </div>
    </main>
</Layout>
