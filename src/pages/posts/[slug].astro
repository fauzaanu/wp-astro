---
import { getPosts } from '../../../lib/api';

const { slug } = Astro.params;

import Layout from '~/layouts/Layout.astro';

export async function getStaticPaths() {
    let posts = await getPosts();

    return posts.map((post) => {
        return {
            params: { slug: post.slug },
            props: {
                title: post.title.rendered,
                content: post.content.rendered,
                image: post._embedded['wp:featuredmedia']['0'].source_url,

                // Spreading the Custom Fields into a meta object
                meta: {
                    ...post.acf,
                },
            },
        };
    });
}

const { title, content, image, meta } = Astro.props;
---

<Layout title={title}>
    <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-serif font-bold text-gray-900 mb-4" set:html={title} />
            {meta.author && (
                <div class="text-gray-600">
                    By <span class="font-medium">{meta.author}</span> â€¢ 
                    <time datetime={meta.date}>
                        {new Date(meta.date).toLocaleDateString('en-US', {
                            month: 'long',
                            day: 'numeric',
                            year: 'numeric'
                        })}
                    </time>
                </div>
            )}
        </header>

        <figure class="mb-12">
            <img
                src={image}
                alt={title}
                class="w-full h-[500px] object-cover rounded-lg"
            />
        </figure>

        <div class="prose prose-lg max-w-none">
            <Fragment set:html={content} />
        </div>
    </article>
</Layout>
