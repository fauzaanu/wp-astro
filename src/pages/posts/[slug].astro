---
import { getPosts, fetchPostBySlug } from '../../../lib/api'; // Import the functions
import Layout from '~/layouts/Layout.astro';

// This will be used by Astro to generate paths for all dynamic pages
export async function getStaticPaths() {
    // Fetch all posts to generate the dynamic paths
    let posts = await getPosts();

    // Generate paths for each post based on the slug
    return posts.map((post) => {
        return {
            params: { slug: post.slug },
        };
    });
}

// Now, fetch the data for the specific post based on its slug
const { slug } = Astro.params;
const post = await fetchPostBySlug(slug);

const { title, content, image, meta, custom } = post;
---

<Layout title={title.rendered}>
    <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-serif font-bold text-gray-900 mb-4" set:html={title.rendered} />
            {meta.author && (
                <div class="text-gray-600">
                    By <span class="font-medium">{meta.author}</span> â€¢
                    <time datetime={meta.date}>
                        {new Date(meta.date).toLocaleDateString('en-US', {
                            month: 'long',
                            day: 'numeric',
                            year: 'numeric'
                        })}
                    </time>
                </div>
            )}
        </header>

        <figure class="mb-12">
            <img
                src={custom.featured_image}
                alt={title.rendered}
                class="w-full max-h-[600px] h-auto object-contain rounded-lg mx-auto"
                srcset={`${custom.featured_image} 1200w, ${custom.featured_image} 800w, ${custom.featured_image} 400w`}
                sizes="(max-width: 1200px) 100vw, 1200px"
                loading="eager"
                decoding="async"
            />
        </figure>

        <div class="prose prose-lg max-w-none text-zinc-900">
            <Fragment set:html={content.rendered} />
        </div>
    </article>
</Layout>
